var sketch=function(b){var n,r=screen.availWidth-32,x=Math.floor(.75*r),t=672<screen.availWidth?{width:640,height:480}:{width:r,height:x},y={1:"#ffff00",2:"#ff0000",3:"#00ff00",4:"#000000"},e=[],k=[],z=Math.pow(10,2),g,u,v,w,p,f={SUSCEPTIBLE:1,INFECTIOUS:2,RECOVERED:3,QUARANTINED:4},h={popsize:300,recoveryTimeInMillis:2E3,infectionProbability:1,detectionSuccessRate:.5,speed:2};b.getNumberOfBalls=function(){return g};b.getDefaultValues=function(){return h};b.getStatus=function(){return f};b.getStatusArray=
function(){for(var a=[],d=0;d<e.length;d++)a[d]=e[d].status;return a};b.checkForRecovered=function(){var a=0,d=0;k.forEach(function(c){a=normRand(u,900);d=0>a?0:Math.ceil(a);void 0!==c.time&&Date.now()-c.time>d&&(c.time=void 0,e[c.index].status=f.RECOVERED);e[c.index].status===f.INFECTIOUS&&Math.random()<=w&&(e[c.index].status=f.QUARANTINED)})};b.setup=function(){n=b.createCanvas(t.width,t.height);n.parent("sirsim-container");b.frameRate(30);this.reset()};b.reset=function(a){n.mouseClicked(function(){var d=
!0,c;return function(){if(d)d=!1,c=Date.now(),b.noLoop(),graph&&graph._setupDone&&graph.noLoop();else{d=!0;var q=Date.now()-c;k.forEach(function(l){l.time&&(l.time+=q)});b.loop();graph&&graph._setupDone&&graph.loop()}}}());playing=!0;b.loop();e=[];k=[];g=a&&a.popsize?a.popsize:h.popsize;u=a&&a.recoveryTimeInMillis?a.recoveryTimeInMillis:h.recoveryTimeInMillis;v=a&&a.infectionProbability?a.infectionProbability:h.infectionProbability;w=a&&a.detectionSuccessRate?a.detectionSuccessRate:h.detectionSuccessRate;
p=a&&a.speed?a.speed:h.speed;for(a=0;a<g;a++)e[a]=new m(b.random(b.width),b.random(b.height),10,a,e,f.SUSCEPTIBLE);e[g-1].status=f.INFECTIOUS;k.push({time:Date.now(),index:g-1});graph&&graph._setupDone&&graph.reset()};b.draw=function(){b.background(0,87,255);b.checkForRecovered();e.forEach(function(a){b.push();b.noStroke();b.fill(y[a.status]);a.collide();a.move();a.display();b.pop()})};var m=function(a,d,c,q,l,A){this.x=a;this.y=d;this.vx=b.random(-1,1)*p;this.vy=b.random(-1,1)*p;this.diameter=c;
this.id=q;this.others=l;this.status=A};m.prototype.collide=function(){for(var a=0;a<g;a++){var d=this.others[a].x-this.x,c=this.others[a].y-this.y;Math.pow(d,2)+Math.pow(c,2)<z&&(c=b.atan2(c,d),d=this.x+10*b.cos(c),c=this.y+10*b.sin(c),d=.1*(d-this.others[a].x),c=.1*(c-this.others[a].y),this.vx-=d,this.vy-=c,this.others[a].vx+=d,this.others[a].vy+=c,this.checkForStatusChange(a))}};m.prototype.checkForStatusChange=function(a){this.status===f.SUSCEPTIBLE&&this.others[a].status===f.INFECTIOUS&&Math.random()<=
v&&(this.status=f.INFECTIOUS,k.push({time:Date.now(),index:this.id}))};m.prototype.move=function(){this.x+=this.vx;this.y+=this.vy;this.x+this.diameter/2>b.width?(this.x=b.width-this.diameter/2,this.vx*=-1):0>this.x-this.diameter/2&&(this.x=this.diameter/2,this.vx*=-1);this.y+this.diameter/2>b.height?(this.y=b.height-this.diameter/2,this.vy*=-1):0>this.y-this.diameter/2&&(this.y=this.diameter/2,this.vy*=-1)};m.prototype.display=function(){b.circle(this.x,this.y,10)}};